# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Folioo Server는 포트폴리오 관리 플랫폼의 백엔드 서버입니다.

- **Runtime**: Node.js 24 + pnpm 10
- **Framework**: NestJS 11
- **Language**: TypeScript 5.7
- **ORM**: TypeORM 0.3
- **Database**: PostgreSQL
- **Build Tool**: SWC

## Commands

```bash
# 의존성 설치
pnpm install

# 개발 서버 실행 (Docker DB 필요)
docker compose up -d && pnpm run start:dev

# 디버그 모드
pnpm run start:debug

# 빌드
pnpm run build

# 린트 & 포맷팅
pnpm run lint
pnpm run lint:fix
pnpm run format

# 테스트
pnpm run test              # 단위 테스트
pnpm run test:watch        # watch 모드
pnpm run test:cov          # 커버리지
pnpm run test:e2e          # E2E 테스트

# 단일 테스트 파일 실행
pnpm run test -- user.service.spec.ts

# Docker
docker compose up -d       # PostgreSQL 실행
docker compose down        # 종료
docker build -t folioo-server .  # 프로덕션 빌드
```

## Architecture

DDD 기반 계층형 아키텍처 (Package by Feature + Layered Architecture)

```
src/
├── common/                 # 공통 모듈 (decorators, filters, interceptors, exceptions)
├── config/                 # 설정 (swagger, typeorm)
└── modules/                # 비즈니스 도메인
    └── {domain}/
        ├── domain/         # 엔티티
        ├── application/    # 서비스, DTO
        ├── infrastructure/ # 리포지토리
        └── presentation/   # 컨트롤러
```

### Domain Classification

| 도메인 | 분류 | 설명 |
|--------|------|------|
| **Experience** | Core | 경험 정리 (AI 채팅 포함) |
| **Portfolio** | Core | 포트폴리오 |
| **Portfolio-Correction** | Core | 포트폴리오 첨삭 서비스 |
| **Insight** | Supporting | 인사이트/팁 정리 |
| **User** | Supporting | 사용자 도메인 |
| **Auth** | Generic | 인증 (Kakao/Google/Apple OAuth) |
| **Payment** | Generic | 결제 (예정) |

### Layer Dependencies

```
Controller → Service → Repository → Entity
    ↓           ↓           ↓
   DTO         DTO       Entity
```

## Key Conventions

### Error Handling

`BusinessException`과 `ErrorCode`를 사용 (`common/exceptions/` 참조):

```typescript
throw new BusinessException(ErrorCode.USER_NOT_FOUND);
throw new BusinessException(ErrorCode.UNAUTHORIZED);
```

### Entity Relations

순환참조 방지를 위해 **단방향 매핑(ManyToOne)만 사용**:

```typescript
@ManyToOne(() => User, { lazy: true, onDelete: 'CASCADE' })
@JoinColumn({ name: 'user_id' })
user: User;
```

### Swagger

NestJS Swagger CLI Plugin 사용 중 - 기본 타입은 자동 추론됨.
`@ApiProperty()`는 example, enum 등 자세한 명세가 필요한 경우에만 사용.

### Code Style

- **DTO**: `class-validator` 데코레이터 사용
- **Entity**: `TypeORM` 데코레이터 사용
- **DI**: 생성자 주입 사용 (`@Injectable()` + constructor)

### Commit Messages

```
<type>: <subject> (#<issue_number>)

<body>
```

**Type**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `rename`, `remove`

**예시**:
```bash
git commit -m "feat: 포트폴리오 CRUD API 구현 (#15)

- 포트폴리오 생성/조회/수정/삭제 엔드포인트 추가
- DTO 및 엔티티 정의
- Swagger 문서 업데이트"
```

**CRITICAL**: AI 생성 표시 절대 금지 (Co-Authored-By, Generated by AI 등)

### Branch/Issue/PR Naming

- **Branch**: `feat/portfolio-crud-#15`
- **Issue**: `[Feat] 포트폴리오 CRUD API 구현`
- **PR**: `Feat: 포트폴리오 CRUD API 구현 (#15)`

## Documentation References

상세한 내용은 아래 문서 참조:

| 문서 | 경로 |
|------|------|
| 아키텍처 | `docs/architecture/ARCHITECTURE.md` |
| ERD/DB 설계 | `docs/architecture/ERD.md` |
| 코드 스타일 | `docs/development/CODE_STYLE.md` |
| Git 컨벤션 | `docs/development/CONVENTIONS.md` |
| PR 템플릿 | `.github/PULL_REQUEST_TEMPLATE.md` |
| Issue 템플릿 | `.github/ISSUE_TEMPLATE/` |
